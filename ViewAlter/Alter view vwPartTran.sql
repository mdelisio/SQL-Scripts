SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
ALTER VIEW [etl].[vwPartTran] AS

SELECT [Company]
      ,[SysDate]
      ,[SysTime]
      ,Dateadd(second, SysTime, cast(SysDate as Datetime)) as SystemDateTime
      ,[TranNum]
      ,[PartNum]
      ,[WareHouseCode]
      ,[BinNum]
      ,[TranClass]
      ,[TranType]
      ,[InventoryTrans]
      ,[TranDate]
      ,[TranQty]
      ,[UM]
      ,[MtlUnitCost]
      ,[LbrUnitCost]
      ,[BurUnitCost]
      ,[SubUnitCost]
      ,[MtlBurUnitCost]
      ,[ExtCost]
      ,[CostMethod]
      ,[JobNum]
      ,[AssemblySeq]
      ,[JobSeqType]
      ,[JobSeq]
      ,[PackType]
      ,[PackNum]
      ,[PackLine]
      ,[PONum]
      ,[POLine]
      ,[PORelNum]
      ,[WareHouse2]
      ,[BinNum2]
      ,[OrderNum] as OrderNumRef
      ,[OrderLine] as OrderlineRef
      ,REVERSE(PARSENAME(REPLACE(REVERSE([JobNum]), '-', '.'), 1)) as OrderNum
      ,REVERSE(PARSENAME(REPLACE(REVERSE([JobNum]), '-', '.'), 2)) as OrderLine
      ,(Case
        When
            REVERSE(PARSENAME(REPLACE(REVERSE([JobNum]), '-', '.'), 2)) is Null
        Then
            REVERSE(PARSENAME(REPLACE(REVERSE([JobNum]), '-', '.'), 1))
        Else
            CONCAT(REVERSE(PARSENAME(REPLACE(REVERSE([JobNum]), '-', '.'), 1))
            ,'-'
            ,REVERSE(PARSENAME(REPLACE(REVERSE([JobNum]), '-', '.'), 2))
        )
        end) as OrderNumLine
      ,[OrderRelNum]
      ,[EntryPerson]
      ,[TranReference]
      ,[PartDescription]
      ,[RevisionNum]
      ,[VendorNum]
      ,[PurPoint]
      ,[POReceiptQty]
      ,[POUnitCost]
      ,[PackSlip]
      ,[InvoiceNum]
      ,[InvoiceLine]
      ,[InvAdjSrc]
      ,[InvAdjReason]
      ,[LotNum]
      ,[DimCode]
      ,[DUM]
      ,[DimConvFactor]
      ,[LotNum2]
      ,[DimCode2]
      ,[DUM2]
      ,[DimConvFactor2]
      ,[GLTrans]
      ,[PostedToGL]
      ,[FiscalYear]
      ,[FiscalPeriod]
      ,[JournalNum]
      ,[Costed]
      ,[DMRNum]
      ,[ActionNum]
      ,[RMANum]
      ,[COSPostingReqd]
      ,[JournalCode]
      ,[Plant]
      ,[Plant2]
      ,[CallNum]
      ,[CallLine]
      ,[MatNum]
      ,[JobNum2]
      ,[AssemblySeq2]
      ,[JobSeq2]
      ,[CustNum]
      ,[RMALine]
      ,[RMAReceipt]
      ,[RMADisp]
      ,[OtherDivValue]
      ,[PlantTranNum]
      ,[NonConfID]
      ,[MtlMtlUnitCost]
      ,[MtlLabUnitCost]
      ,[MtlSubUnitCost]
      ,[MtlBurdenUnitCost]
      ,[RefType]
      ,[RefCode]
      ,[LegalNumber]
      ,[BeginQty]
      ,[AfterQty]
      ,[BegBurUnitCost]
      ,[BegLbrUnitCost]
      ,[BegMtlBurUnitCost]
      ,[BegMtlUnitCost]
      ,[BegSubUnitCost]
      ,[AfterBurUnitCost]
      ,[AfterLbrUnitCost]
      ,[AfterMtlBurUnitCost]
      ,[AfterMtlUnitCost]
      ,[AfterSubUnitCost]
      ,[PlantCostValue]
      ,[EmpID]
      ,[ReconcileNum]
      ,[CostID]
      ,[FIFODate]
      ,[FIFOSeq]
      ,[ActTranQty]
      ,[ActTransUOM]
      ,[InvtyUOM]
      ,[InvtyUOM2]
      ,[FIFOAction]
      ,[FiscalYearSuffix]
      ,[FiscalCalendarID]
      ,[BinType]
      ,[CCYear]
      ,[CCMonth]
      ,[CycleSeq]
      ,[ABTUID]
      ,[BaseCostMethod]
      ,[RevertStatus]
      ,[RevertID]
      ,[DropShipPackSlip]
      ,[VarTarget]
      ,[FIFOSubSeq]
      ,[AltMtlUnitCost]
      ,[AltLbrUnitCost]
      ,[AltBurUnitCost]
      ,[AltSubUnitCost]
      ,[AltMtlBurUnitCost]
      ,[AltExtCost]
      ,[AltMtlMtlUnitCost]
      ,[AltMtlLabUnitCost]
      ,[AltMtlSubUnitCost]
      ,[AltMtlBurdenUnitCost]
      ,[TranDocTypeID]
      ,[PBInvNum]
      ,[LoanFlag]
      ,[AssetNum]
      ,[AdditionNum]
      ,[DisposalNum]
      ,[ProjProcessed]
      ,[AsOfDate]
      ,[AsOfSeq]
      ,[MscNum]
      ,[ODCUnitCost]
      ,[SysRevID]
      ,[SysRowID]
      ,[TranRefType]
      ,[PCID]
      ,[PCIDCollapseCounter]
      ,[PCID2]
      ,[ContractID]
      ,[LCFlag]
      ,[ExtMtlCost]
      ,[ExtLbrCost]
      ,[ExtBurCost]
      ,[ExtSubCost]
      ,[ExtMtlBurCost]
      ,[ExtMtlMtlCost]
      ,[ExtMtlLabCost]
      ,[ExtMtlSubCost]
      ,[ExtMtlBurdenCost]
      ,[MYImportNum]
      ,[AutoReverse]
      ,[RevTranNum]
      ,[RevSysDate]
      ,[RevSysTime]
      ,Dateadd(second, RevSysTime, cast(RevSysDate as Datetime)) as RevSysDateTime
      ,[ExtNonRecoverableCost]
      ,[EpicorFSA]
      ,[AttributeSetID]
      ,[AttributeSetDescription]
      ,[AttributeSetShortDescription]
      ,[NumberOfPieces]
  FROM [ERPDB].[Erp].[PartTran]
GO
