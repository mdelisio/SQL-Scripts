--Declare @ProjectID Varchar(50)
--Set @ProjectID = '2026722';
Declare @Company Varchar(50)
Set @Company = 'Solar';


With ProjectPhaseRollup
AS (SELECT Company,
           ProjectID,
           OrderNum,
           OrderLine,
           Sum(BudTotLbrCost + BudTotBurCost + BudTotSubCost + BudTotMtlCost + BudTotMtlBurCost + BudTotODCCost) as BudgetedCosts,
           Sum(TotQuotODCCost) as QuotedOtherDirectCosts,
           Sum(TotQuotODCCost + TotQuotLbrCost + TotQuotBurCost + TotQuotSubContCost + TotQuotMtlCost+ TotQuotMtlBurCost) as QuotedCosts,
           SUM([TotActLbrCost]+[TotActBurCost]+[TotActSubContCost]+[TotActMtlCost]+[TotActMtlBurCost]+[TotActODCCost]) as ActualCost,
           Sum(TotWBSPhaseRev) as SellPrice,
           Sum(ConTotValue) as ContractPrice
           From ERPDB.ERP.ProjPhase
    -- Where clause for Level only includes project phases at the top level which are already summarized from lower levels
    Where Level = 1
    Group By Company,
             ProjectID,
             OrderNum,
             OrderLine
)

Select Company,
       ProjectID,
       SUM(pp.SellPrice) as TotalSellPrice,
       SUM(pp.QuotedCosts) as TotalQuotedCosts,
       SUM(pp.ActualCost) as TotalActualCosts,
       SUM(pp.BudgetedCosts) as TotalBudgetedCosts,
       SUM(pp.ContractPrice) as TotalContractPrice

FROM ProjectPhaseRollup pp
Where ProjectID in ('2128153','2084853','2026722','2026273','22221186','2127593','2087311','2127530','2026533','1924394','21819693',
'2085997','1924508','2024949','1984681','2187422','22222709','1924414','21817869','2188156','2087308','2127597','2085999','2188416',
'22821406','2084802','22824905','2187766','21417319','2025231','2087392','2087351','2087293','1984638','22224481','21218428','2128188',
'2187429','2127903','2045998','1984697','2087291','2087320','22824777','2026328','22222325','2027096','2128166','22221256','2026668',
'2128015','21218225','2147614','2027054','21218224','21219305','1984676','22221336','2127847','2026067','2027053','2128115','21219990',
'21218432','2026327','22222241','22224594','2128195','21219482','22224737','2026713','2128239','21818861','2187790','2128164',
'22222849','2026719','22222405','21217250','2025185','2087242','22220302','2086000','22821371','21219733','21818418','22220322',
'21218866','2045819','21219710','22225007','22224579','22823326','22820524','22220357','2128212','22220954','21219123','1984693',
'21217252','2127679','2027376','21220164','2026289','22225027','21219118','22224739','2127469','2087218','21220163','22224596','21219235',
'2026781','21219396','22221830','2127923','22225055','22221997','2046773','1923912','22222195','2025891','2086036','21220122','2027241',
'22223705','22220593','2045963','22221829','2085033','2127668','21219102','21217353','23225588','22222178','22220303','1923651','22221248',
'2187599','21219595','22223839','22223320','2025892','21219709','22221221','2128135','22220300','21218597','2027118','21218245','2026785',
'2127540','2188068','22221831','2087125','22225023','1923976','2127680','21217886','2128238','22220570','21219783','22220407',
'2027337','22221337','22224873','21219624','22220957','21219729','22220435','22225026','22221255','22221996','2025968','21219691',
'22821596','22225341','22222320','22221929','22220503','22225020','2187728','21219035','1984263','1984386','21417385','22220797',
'2027303','21217636','2025743','2026081','2127567','22224623','22220796','21818005','1924227','21212106','22222194','21219787',
'22224978','21219540','22222411','22223843','22223840','22224621','21217006','22220556','22224619','2128447','2127669','22823075',
'1984279','22224465','22221179','21219113','22225330','22223841','22223699','1823057C','2087156','2026192','22823072','21218581',
'23226209','21818155','2024988','22224210','22223366','22225217','2127471','22221495','22824497','22225232','22225010','22224751',
'2026163','22225260','22224707','22224709','21219860','21218633','21220175','21218730','23825477','22822073','22222466','22222468',
'22221156','22221632','22223508','22223414','22222211','23226334','23226336','1944031','22224766','22223096','22223129','22224433',
'21219412','22823819','22222728','22224277','22223138','22223139','22224710','23225418','23826187','23225472','21219934','21218401',
'22222467','22221295','22222726','22222724','22223137','22223586','21219921','22222543','22221722','22822235','22821676','22221115',
'22222722','22821125','23826351','22223844','22823820','2086769','22221673','21219891','22221496','22221848','22222649','22223635',
'2127484','23226196','22222328','22222484','22225067','22225069','22225070','22222369','22221118','22224904','22225149','22225150',
'22220355','21219812','2025683','22221116','21219814','22225151','22225152','23825801','23225514','22223229','2025215','21218577',
'21219195','2027374','22221774','21219106','2026767','22222615','22220339','2026071','22221721','22220581','21220026','22223287',
'22224007','2128155','1883320','2046774','22822571','21219566','1923775','22220408','1924689','1984684','21219927','2128152',
'2026766','22220512','22220374','22223284','22824464','20269821','22220369','22224732','1924574','2027238','21220075','22221629',
'22222102','23225968','23226343','1984315','2086188','23825484','23825780','23825781','23825970'
)

      and Company = @Company
Group by ProjectID,
         Company


/*
Declare @ProjectID Varchar(50)
Set @ProjectID = '1924394';
Declare @Company Varchar(50)
Set @Company = 'Solar';

SELECT TOP (1000) *
  FROM [ERPDB].[Erp].[ProjPhase]
  Where ProjectID = @ProjectID
      and Company = @Company
      and Level = 1
*/


           ProjectID,
           OrderNum,
           OrderLine,

           BudTotLbrCost, 
           BudTotBurCost,
           BudTotSubCost,
           BudTotMtlCost,
           BuddTotMtlBurCost,
           BudTotODCCost,

           TotQuotODCCost,
           TotQuotLbrCost,
           TotQuotBurCost,
           TotQuotSubContCost,
           TotQuotMtlCost,
           TotQuotMtlBurCost,

           TotActLbrCost,
           TotActBurCost,
           TotActSubContCost,
           TotActMtlCost,
           TotActMtlBurCost,
           TotActODCCost,
                      
           TotWBSPhaseRev