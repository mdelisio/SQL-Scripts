
With PartTrans
as ( Select
      [Company],
      JobNum
      ,Dateadd(second, SysTime, cast(SysDate as Datetime)) as SystemDateTime

      ,REVERSE(PARSENAME(REPLACE(REVERSE([JobNum]), '-', '.'), 1)) as OrderNum
      ,REVERSE(PARSENAME(REPLACE(REVERSE([JobNum]), '-', '.'), 2)) as OrderLine
      ,(Case
        When
            REVERSE(PARSENAME(REPLACE(REVERSE([JobNum]), '-', '.'), 2)) is Null
        Then
            REVERSE(PARSENAME(REPLACE(REVERSE([JobNum]), '-', '.'), 1))
        Else
            CONCAT(REVERSE(PARSENAME(REPLACE(REVERSE([JobNum]), '-', '.'), 1))
            ,'-'
            ,REVERSE(PARSENAME(REPLACE(REVERSE([JobNum]), '-', '.'), 2))
        )
        end) as OrderNumLine
  FROM [ERPDB].[Erp].[PartTran]
  )

Select Distinct
    pt.jobnum,
    od.ProjectID
from Parttrans pt
    Left Join [etl].[vwOrderDetail] AS od
        on pt.OrderNumLine = od.OrderNumLine
           and pt.company = od.company
WHERE od.ProjectID in ( '2128153', '22221186', '2187422', '21819693', '21817869', '2188156', '2188416', '2187766',
                        '21417319', '2128188', '2187429', '2127903', '2128015', '2147614', '2128115', '2128166',
                        '2127847', '2128195', '2128239', '2128164', '2187790', '22221336', '21818861', '22220302',
                        '2128212', '22220954', '2127679', '2128456', '21818418', '2127923', '2127668', '22220303',
                        '2187599', '22222178', '22222195', '2128135', '22220300', '2188068', '2127680', '22220407',
                        '2128238', '22222849', '2187728', '22221337', '22220957', '22223705', '21417385', '22221929',
                        '22821406', '21818005', '22222194', '22220796', '2128447', '2127669', '22223840', '22220797',
                        '22821596', '22222411', '22223841', '22222320', '22224978', '22223843', '22220556', '22224465',
                        '22823072', '22222325', '22221495', '22824497', '22225232', '22224751', '22225217', '22222466',
                        '22222468', '22221632', '22223508', '22223414', '22221156', '22224766', '22823819', '22222467',
                        '22222728', '22222543', '22223320', '22221722', '22221115', '22821676', '22223138', '22221295',
                        '22221848', '22221673', '22222328', '22222484', '22222369', '22224710', '22222726', '22220355',
                        '22222649', '22223635', '22224707', '21818155', '22224709', '22221116', '22224904', '22224481',
                        '22823820', '22223137', '22223586', '22221118', '23825477', '22220435', '22223229', '22221496',
                        '22222722', '22223096', '22222615', '22220339', '22221774', '22221721', '22822073', '22223366',
                        '22224007', '22821125', '22222724', '22223287', '22224277', '22223139', '22223844', '2128155',
                        '22222709', '1883320', '22822571', '22220581', '22225260', '2128152', '22220408', '22222211',
                        '22823075', '23225472', '22220512', '22823326', '22221997', '22221996', '22220374', '22220357',
                        '22221179', '22220503', '22223284', '22824464', '22220322', '22225151', '22220369'
                      )
and od.Company = 'Solar'